{"ast":null,"code":"import axios from'axios';import{jwtDecode}from'jwt-decode';import dayjs from'dayjs';import{useContext}from'react';import AuthContext from'../context/AuthContext';const baseURL='http://127.0.0.1:8000/api';const useAxios=()=>{const{authTokens,setUser,setAuthTokens}=useContext(AuthContext);const axiosInstance=axios.create({baseURL,headers:{Authorization:`Bearer ${authTokens===null||authTokens===void 0?void 0:authTokens.access}`}});axiosInstance.interceptors.request.use(async req=>{const user=jwtDecode(authTokens.access);const isExpired=dayjs.unix(user.exp).diff(dayjs())<1;if(!isExpired)return req;const response=await axios.post(`${baseURL}/token/refresh/`,{refresh:authTokens.refresh});localStorage.setItem('authTokens',JSON.stringify(response.data));setAuthTokens(response.data);setUser(jwtDecode(response.data.access));req.headers.Authorization=`Bearer ${response.data.access}`;return req;});return axiosInstance;};export default useAxios;","map":{"version":3,"names":["axios","jwtDecode","dayjs","useContext","AuthContext","baseURL","useAxios","authTokens","setUser","setAuthTokens","axiosInstance","create","headers","Authorization","access","interceptors","request","use","req","user","isExpired","unix","exp","diff","response","post","refresh","localStorage","setItem","JSON","stringify","data"],"sources":["/home/taku_prosper/Music/IS/Frontend/elsf/src/utils/useAxios.js"],"sourcesContent":["import axios from 'axios';\nimport { jwtDecode } from 'jwt-decode';\nimport dayjs from 'dayjs';\nimport { useContext } from 'react';\nimport AuthContext from '../context/AuthContext';\n\nconst baseURL = 'http://127.0.0.1:8000/api';\n\nconst useAxios = () => {\n  const { authTokens, setUser, setAuthTokens } = useContext(AuthContext);\n\n  const axiosInstance = axios.create({\n    baseURL,\n    headers: { Authorization: `Bearer ${authTokens?.access}` },\n  });\n\n  axiosInstance.interceptors.request.use(async (req) => {\n    const user = jwtDecode(authTokens.access);\n    const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\n\n    if (!isExpired) return req;\n\n    const response = await axios.post(`${baseURL}/token/refresh/`, {\n      refresh: authTokens.refresh,\n    });\n    localStorage.setItem('authTokens', JSON.stringify(response.data));\n\n    setAuthTokens(response.data);\n    setUser(jwtDecode(response.data.access));\n\n    req.headers.Authorization = `Bearer ${response.data.access}`;\n    return req;\n  });\n\n  return axiosInstance;\n};\n\nexport default useAxios;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,SAAS,KAAQ,YAAY,CACtC,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,UAAU,KAAQ,OAAO,CAClC,MAAO,CAAAC,WAAW,KAAM,wBAAwB,CAEhD,KAAM,CAAAC,OAAO,CAAG,2BAA2B,CAE3C,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACrB,KAAM,CAAEC,UAAU,CAAEC,OAAO,CAAEC,aAAc,CAAC,CAAGN,UAAU,CAACC,WAAW,CAAC,CAEtE,KAAM,CAAAM,aAAa,CAAGV,KAAK,CAACW,MAAM,CAAC,CACjCN,OAAO,CACPO,OAAO,CAAE,CAAEC,aAAa,CAAE,UAAUN,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEO,MAAM,EAAG,CAC3D,CAAC,CAAC,CAEFJ,aAAa,CAACK,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,KAAO,CAAAC,GAAG,EAAK,CACpD,KAAM,CAAAC,IAAI,CAAGlB,SAAS,CAACM,UAAU,CAACO,MAAM,CAAC,CACzC,KAAM,CAAAM,SAAS,CAAGlB,KAAK,CAACmB,IAAI,CAACF,IAAI,CAACG,GAAG,CAAC,CAACC,IAAI,CAACrB,KAAK,CAAC,CAAC,CAAC,CAAG,CAAC,CAExD,GAAI,CAACkB,SAAS,CAAE,MAAO,CAAAF,GAAG,CAE1B,KAAM,CAAAM,QAAQ,CAAG,KAAM,CAAAxB,KAAK,CAACyB,IAAI,CAAC,GAAGpB,OAAO,iBAAiB,CAAE,CAC7DqB,OAAO,CAAEnB,UAAU,CAACmB,OACtB,CAAC,CAAC,CACFC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAEC,IAAI,CAACC,SAAS,CAACN,QAAQ,CAACO,IAAI,CAAC,CAAC,CAEjEtB,aAAa,CAACe,QAAQ,CAACO,IAAI,CAAC,CAC5BvB,OAAO,CAACP,SAAS,CAACuB,QAAQ,CAACO,IAAI,CAACjB,MAAM,CAAC,CAAC,CAExCI,GAAG,CAACN,OAAO,CAACC,aAAa,CAAG,UAAUW,QAAQ,CAACO,IAAI,CAACjB,MAAM,EAAE,CAC5D,MAAO,CAAAI,GAAG,CACZ,CAAC,CAAC,CAEF,MAAO,CAAAR,aAAa,CACtB,CAAC,CAED,cAAe,CAAAJ,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}