{"ast":null,"code":"import{createContext,useState,useEffect}from\"react\";import{jwtDecode}from'jwt-decode';import{useNavigate}from'react-router-dom';import swal from'sweetalert2';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export default AuthContext;export const AuthProvider=_ref=>{let{children}=_ref;const[authTokens,setAuthTokens]=useState(()=>localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null);const[user,setUser]=useState(()=>localStorage.getItem(\"authTokens\")?jwtDecode(localStorage.getItem(\"authTokens\")):null);const[loading,setLoading]=useState(true);const navigate=useNavigate();const loginUser=async(email,password)=>{const response=await fetch(\"http://127.0.0.1:8000/api/token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email,password})});const data=await response.json();console.log(data);if(response.status===200){console.log(\"Logged In\");setAuthTokens(data);setUser(jwtDecode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));navigate('/',{replace:true});swal.fire({title:\"Login Successful\",icon:\"success\",toast:true,timer:6000,position:'top-right',timerProgressBar:true,showConfirmButton:false});}else{console.log(response.status);console.log(\"there was a server issue\");swal.fire({title:\"Username or password is incorrect. Please try again!\",icon:\"error\",toast:true,timer:6000,position:'top-right',timerProgressBar:true,showConfirmButton:false});}};const registerUser=async(email,username,password,password2)=>{const response=await fetch(\"http://127.0.0.1:8000/api/register/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email,username,password,password2})});if(response.status===201){navigate('/login',{replace:true});swal.fire({title:\"Registration Successful, Login Now\",icon:\"success\",toast:true,timer:6000,position:'top-right',timerProgressBar:true,showConfirmButton:false});}else{console.log(response.status);console.log(\"there was a server issue\");swal.fire({title:\"An Error Occured \"+response.status,icon:\"error\",toast:true,timer:6000,position:'top-right',timerProgressBar:true,showConfirmButton:false});}};const logoutUser=()=>{setAuthTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");navigate('/login',{replace:true});swal.fire({title:\"You have been logged out...\",icon:\"success\",toast:true,timer:6000,position:'top-right',timerProgressBar:true,showConfirmButton:false});};const contextData={user,setUser,authTokens,setAuthTokens,registerUser,loginUser,logoutUser};useEffect(()=>{if(authTokens){setUser(jwtDecode(authTokens.access));}setLoading(false);},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"names":["createContext","useState","useEffect","jwtDecode","useNavigate","swal","jsx","_jsx","AuthContext","AuthProvider","_ref","children","authTokens","setAuthTokens","localStorage","getItem","JSON","parse","user","setUser","loading","setLoading","navigate","loginUser","email","password","response","fetch","method","headers","body","stringify","data","json","console","log","status","access","setItem","replace","fire","title","icon","toast","timer","position","timerProgressBar","showConfirmButton","registerUser","username","password2","logoutUser","removeItem","contextData","Provider","value"],"sources":["/home/taku_prosper/Music/IS/Frontend/elsf/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useState, useEffect } from \"react\";\nimport { jwtDecode } from 'jwt-decode';\nimport { useNavigate } from 'react-router-dom';\nimport swal from 'sweetalert2';\n\nconst AuthContext = createContext();\n\nexport default AuthContext;\n\nexport const AuthProvider = ({ children }) => {\n    const [authTokens, setAuthTokens] = useState(() =>\n        localStorage.getItem(\"authTokens\")\n            ? JSON.parse(localStorage.getItem(\"authTokens\"))\n            : null\n    );\n\n    const [user, setUser] = useState(() => \n        localStorage.getItem(\"authTokens\")\n            ? jwtDecode(localStorage.getItem(\"authTokens\"))\n            : null\n    );\n\n    const [loading, setLoading] = useState(true);\n\n    const navigate = useNavigate();\n\n    const loginUser = async (email, password) => {\n        const response = await fetch(\"http://127.0.0.1:8000/api/token/\", {\n            method: \"POST\",\n            headers:{\n                \"Content-Type\":\"application/json\"\n            },\n            body: JSON.stringify({\n                email, password\n            })\n        })\n        const data = await response.json()\n        console.log(data);\n\n        if(response.status === 200){\n            console.log(\"Logged In\");\n            setAuthTokens(data)\n            setUser(jwtDecode(data.access))\n            localStorage.setItem(\"authTokens\", JSON.stringify(data))\n            navigate('/', { replace: true });\n            swal.fire({\n                title: \"Login Successful\",\n                icon: \"success\",\n                toast: true,\n                timer: 6000,\n                position: 'top-right',\n                timerProgressBar: true,\n                showConfirmButton: false,\n            })\n\n        } else {    \n            console.log(response.status);\n            console.log(\"there was a server issue\");\n            swal.fire({\n                title: \"Username or password is incorrect. Please try again!\",\n                icon: \"error\",\n                toast: true,\n                timer: 6000,\n                position: 'top-right',\n                timerProgressBar: true,\n                showConfirmButton: false,\n            })\n        }\n    }\n\n    const registerUser = async (email, username, password, password2) => {\n        const response = await fetch(\"http://127.0.0.1:8000/api/register/\", {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\":\"application/json\"\n            },\n            body: JSON.stringify({\n                email, username, password, password2\n            })\n        })\n        if(response.status === 201){\n            navigate('/login', { replace: true });\n            swal.fire({\n                title: \"Registration Successful, Login Now\",\n                icon: \"success\",\n                toast: true,\n                timer: 6000,\n                position: 'top-right',\n                timerProgressBar: true,\n                showConfirmButton: false,\n            })\n        } else {\n            console.log(response.status);\n            console.log(\"there was a server issue\");\n            swal.fire({\n                title: \"An Error Occured \" + response.status,\n                icon: \"error\",\n                toast: true,\n                timer: 6000,\n                position: 'top-right',\n                timerProgressBar: true,\n                showConfirmButton: false,\n            })\n        }\n    }\n\n    const logoutUser = () => {\n        setAuthTokens(null)\n        setUser(null)\n        localStorage.removeItem(\"authTokens\")\n        navigate('/login', { replace: true });\n        swal.fire({\n            title: \"You have been logged out...\",\n            icon: \"success\",\n            toast: true,\n            timer: 6000,\n            position: 'top-right',\n            timerProgressBar: true,\n            showConfirmButton: false,\n        })\n    }\n\n    const contextData = {\n        user, \n        setUser,\n        authTokens,\n        setAuthTokens,\n        registerUser,\n        loginUser,\n        logoutUser,\n    }\n\n    useEffect(() => {\n        if (authTokens) {\n            setUser(jwtDecode(authTokens.access))\n        }\n        setLoading(false)\n    }, [authTokens, loading])\n\n    return (\n        <AuthContext.Provider value={contextData}>\n            {loading ? null : children}\n        </AuthContext.Provider>\n    )\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}